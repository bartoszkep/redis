# Użyjemy poprzednio zbudowanego obrazu builddependencies jako podstawy
FROM builddependencies AS build

# Skopiowanie plików źródłowych do obrazu
COPY . /app

# Ustawienie katalogu roboczego na folder z projektem
WORKDIR /app/redis

# Budowanie aplikacji (kompilacja)
RUN make

# Tworzenie czystego obrazu na deploy
FROM debian:stable-slim

# Skopiowanie jedynie skompilowanej aplikacji z poprzedniego etapu
COPY --from=build /app/redis/src/redis-server /usr/local/bin/redis
